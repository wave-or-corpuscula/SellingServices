{% extends "dashboard_base.html" %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Process Order Request</h2>
    <form method="POST">
        <div class="mb-3">
            <label for="clientName" class="form-label">Client Name</label>
            <input type="text" class="form-control" id="clientName" value="{{ request.client.full_name }}" readonly>
        </div>
        <div class="mb-3">
            <label for="clientPhone" class="form-label">Client Phone</label>
            <input type="text" class="form-control" id="clientPhone" value="{{ request.client.telephone }}" readonly>
        </div>
        <div class="mb-3">
            <label for="serviceName" class="form-label">Service</label>
            <input type="text" class="form-control" id="serviceName" value="{{ request.service.service_name }}" readonly>
        </div>
        <div class="mb-3">
            <label for="serviceObject" class="form-label">Service Object</label>
            <select class="form-select" id="serviceObject" name="service_object" required>
                {% for object in service_objects %}
                <option value="{{ object.id }}">{{ object.object_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="count" class="form-label">Count</label>
            <input type="number" class="form-control" id="count" name="count" required>
        </div>
        <div class="mb-3">
            <label for="price" class="form-label">Price</label>
            <input type="number" class="form-control" id="price" name="price" required>
        </div>
        <div class="mb-3">
            <label for="deliveryDate" class="form-label">Delivery Date</label>
            <input type="date" class="form-control" id="deliveryDate" name="delivery_date">
        </div>
        <button type="submit" name="check_stock" class="btn btn-secondary">Check Stock</button>
        <button type="submit" name="create_order" class="btn btn-primary">Create Order</button>

        {% if checked %}
        <div class="mt-3">
            {% if missing_count > 0 %}
            <div class="alert alert-danger" role="alert">
                Missing {{ missing_count }} units.
            </div>
            <button type="submit" name="create_request_for_missing_stock" class="btn btn-warning">Request Missing Stock</button>
            <input type="hidden" name="missing_count" value="{{ missing_count }}">
            {% else %}
            <div class="alert alert-success" role="alert">
                Sufficient stock available.
            </div>
            {% endif %}
        </div>
        {% endif %}
    </form>
</div>
{% endblock %}